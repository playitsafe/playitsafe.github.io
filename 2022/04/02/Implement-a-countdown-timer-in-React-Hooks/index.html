<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Full-stack,JavaScript,CSS,React,Vue,Java,PHP,Developer">
    <meta name="description" content="A full stack web development note of Aaron Zhang. Tech stack including JavaScript, CSS, React, Vue, Java, PHP, Python">
    <meta name="author" content="Aaron Zhang">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <title>
        
            Implement a countdown timer in React Hooks |
        
        Aaron&#39;s Dev Dairy
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/fav.jpg">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"en","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":false,"expand_all":false,"init_open":true},"style":{"primary_color":"#ef675c","avatar":"/images/avatar1.jpg","favicon":"/images/fav.jpg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"Make little things visible."},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":true}},"prefer_mode":"light"},"local_search":{"enable":true,"preload":false},"code_copy":{"enable":true,"style":"mac"},"pjax":{"enable":false},"lazyload":{"enable":true},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
<meta name="generator" content="Hexo 6.1.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
                <a class="logo-image" href="/">
                    <img src="https://us.123rf.com/450wm/get4net/get4net2112/get4net211201501/178384960-double-forward-slash-key-in-computer-keyboard-button.jpg?ver=6">
                </a>
            
            <a class="logo-title" href="/">
                Aaron&#39;s Dev Dairy
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                BLOGS
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                ABOUT ME
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">BLOGS</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">ABOUT ME</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">Implement a countdown timer in React Hooks</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar1.jpg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">Aaron Zhang</span>
                        
                            <span class="author-label">Author</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2022-04-02 04:10:12</span>
        <span class="mobile">2022-04-02 04:10</span>
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/Front-end/">Front-end</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/Hooks/">Hooks</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/React/">React</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/Web/">Web</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h1 id="Prefix"><a href="#Prefix" class="headerlink" title="Prefix"></a>Prefix</h1><hr>
<p>From time to time we will see timers in the world of frontend, of which the use cases could be a count-down function, or a disabled button which will be released active after a certain amount of time to force users to read through site T&amp;C, or a button to send mobile code which is restricted to be clickable within a time interval after last click. Many front-end frameworks have already provided an out-of-box component of that such as <a class="link"   target="_blank" rel="noopener" href="https://procomponents.ant.design/en-US/components/field-set#proformcaptcha" >ProFormCaptcha<i class="fas fa-external-link-alt"></i></a> which to support common CAPTCHA functionality in the middle and backend.</p>
<p>However, we will run into some cases that we need to customize the function as we wish and the provided function from the framework may have limitations. In this case we will need to implement this function by ourself.</p>
<h1 id="Requirements-Analysis"><a href="#Requirements-Analysis" class="headerlink" title="Requirements Analysis"></a>Requirements Analysis</h1><hr>
<p>Ideally, we need to implement a button that behaves like this:</p>
<ul>
<li>First sms will be sent at the time the modal pops up, and the button start to count down util it reaches the time interval.</li>
<li>After each count down, the button will be clickable and will start counting down after each click.</li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/playitsafe/cdn/img/sigma-captcha.gif"
                      alt="captcha demo"
                ></li>
</ul>
<h1 id="Implementation-in-a-React-component"><a href="#Implementation-in-a-React-component" class="headerlink" title="Implementation in a React component"></a>Implementation in a React component</h1><h2 id="Basic-setup"><a href="#Basic-setup" class="headerlink" title="Basic setup:"></a>Basic setup:</h2><hr>
<p>From the perspective of code, will need two states to manage this timer:</p>
<ul>
<li>A state to record the status of the button(disabled or active).</li>
<li>A state to record time left after each seconds</li>
</ul>
<p>So the basic code structure looks like this:</p>
<pre><code class="tsx">import React, &#123; useEffect, useState &#125; from &#39;react&#39;;
import &#123; Input, Button &#125; from &#39;@/my/components&#39;;

const TIME_INTERVAL = 59;

export default const TimerModal = () =&gt; &#123;
    const [seconds, setSeconds] = useState&lt;number&gt;(TIME_INTERVAL);
    const [isCounting, setIsCounting] = useState&lt;boolean&gt;(false);

    const clickHandler = () =&gt; &#123;
        sendCode();
        // reset timer
    &#125;
    
    return (
        &lt;Input /&gt;
        &lt;Button onClick=&#123;clickHandler&#125; disabled=&#123;isCounting&#125; /&gt;
    );
&#125;
</code></pre>
<h2 id="Add-timer-logic"><a href="#Add-timer-logic" class="headerlink" title="Add timer logic"></a>Add timer logic</h2><p>From the requirement above we would know that the <code>TimerModal</code> will pop up and a first SMS has already been sent and the Timer button is disabled and start to count down. In this situation <code>useEffect</code> hook will be a perfect function to host the timer logic.</p>
<h3 id="useEffect-dependency-list"><a href="#useEffect-dependency-list" class="headerlink" title="useEffect() dependency list"></a><code>useEffect()</code> dependency list</h3><p>To listen to the change of the timer button and ensure timer works as we expected, we need to put two of the states(<code>seconds</code> and <code>isCounting</code>) to the dependency list of <code>useEffect</code>. </p>
<h3 id="Inside-of-the-timer-logic"><a href="#Inside-of-the-timer-logic" class="headerlink" title="Inside of the timer logic"></a>Inside of the timer logic</h3><p>We achieve the expected result by updating the <code>seconds</code>(minus 1 in each call) inside a <code>setInterval</code> function. The initial seconds right after the Timer component is mounted is 59s, in the meanwhile, <code>setInterval</code> function inside <code>useEffect</code> hook will update seconds by deducting 1, and this will also trigger useEffect hook again and clear previous setInterval function and start a new session of <code>setInterval()</code> to minus seconds by 1 util it counts down to 1 second, which means the setInterval function is cleared and the countdown session status is reset to inactive(to set <code>isCounting</code> to false and <code>seconds</code> set to initial time interval) and the button will be clickable.</p>
<p>After the button is clicked, the timer will be reset and a new cycle of the useEffect hook will start again.</p>
<pre><code class="tsx">import React, &#123; useEffect, useState &#125; from &#39;react&#39;;
import &#123; Input, Button &#125; from &#39;@/my/components&#39;;

const TIME_INTERVAL = 59;

export default const TimerModal = () =&gt; &#123;
    const [seconds, setSeconds] = useState&lt;number&gt;(TIME_INTERVAL);
    const [isCounting, setIsCounting] = useState&lt;boolean&gt;(true);

    const resetTimer = () =&gt; &#123;
        setSeconds(TIME_INTERVAL);
        setIsCounting(true);
    &#125;

    useEffect((): () =&gt; void =&gt; &#123;
        //setInterval Type would be number if uses window.setInterval()
        let interval: null | NodeJS.Timer = null;
        if (isCounting) &#123;
            interval = setInterval(() =&gt; &#123;
                setSeconds(seconds =&gt; &#123;
                    if (seconds &gt; 1) &#123;
                        return seconds - 1;
                    &#125; else &#123;
                        interval &amp;&amp; clearInterval(interval);
                        setIsCounting(false);
                        return TIME_INTERVAL;
                    &#125;
                &#125; );
            &#125;, 1000);
        &#125; else &#123;
            interval &amp;&amp; clearInterval(interval);
        &#125;
    &#125;, [ isCounting, seconds ])

    const clickHandler = () =&gt; &#123;
        sendCode();
        resetTimer();
    &#125;

    return (
        &lt;Input /&gt;
        &lt;Button onClick=&#123;clickHandler&#125; disabled=&#123;isCounting&#125; /&gt;
    );
&#125;
</code></pre>
<h1 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h1><p>The implementation above seems to perfectly fit the use case, one problem still hides under the hood and will cause memory leakage. If you are on the halfway during countdown session and the Timer component is unmounted(since it’s a modal and will be unmounted after it’s closed), the <code>setInterval</code> function is still there in the background. Luckily, the <code>useEffect</code> hook provides a return callback function to allow us unsubscribe any side effects outside of the React lifecycle, which will be called before the component is unmounted.<br>In this case, we need to return a housekeeping function at the end of the <code>useEffect</code> callback function to clear the <code>setInterval</code> function. So the final code looks like this:</p>
<pre><code class="tsx">import React, &#123; useEffect, useState &#125; from &#39;react&#39;;
import &#123; Input, Button &#125; from &#39;@/my/components&#39;;

const TIME_INTERVAL = 59;

export default const TimerModal = () =&gt; &#123;
    const [seconds, setSeconds] = useState&lt;number&gt;(TIME_INTERVAL);
    const [isCounting, setIsCounting] = useState&lt;boolean&gt;(false);

    const resetTimer = () =&gt; &#123;
        setSeconds(TIME_INTERVAL);
        setIsCounting(true);
    &#125;

    useEffect((): () =&gt; void =&gt; &#123;
        //setInterval Type would be number if uses window.setInterval()
        let interval: null | NodeJS.Timer = null;
        if (isCounting) &#123;
            interval = setInterval(() =&gt; &#123;
                setSeconds(seconds =&gt; &#123;
                    if (seconds &gt; 1) &#123;
                        return seconds - 1;
                    &#125; else &#123;
                        interval &amp;&amp; clearInterval(interval);
                        setIsCounting(false);
                        return TIME_INTERVAL;
                    &#125;
                &#125; );
            &#125;, 1000);
        &#125; else &#123;
            interval &amp;&amp; clearInterval(interval);
        &#125;
        // unsubscription
        return () =&gt; interval &amp;&amp; clearInterval(interval);
    &#125;, [ isCounting, seconds ])

    const clickHandler = () =&gt; &#123;
        sendCode();
        resetTimer();
    &#125;

    return (
        &lt;Input /&gt;
        &lt;Button onClick=&#123;clickHandler&#125; disabled=&#123;isCounting&#125; /&gt;
    );
&#125;
</code></pre>
<p>Another takeaway from this case is that when we update the state which depends on the previous state, we can use a callback function inside <code>useState()</code> hook.<br>the <code>setState()</code> function provided by useState hook accepts either a new state value or a callback function as an updater which returns a new state to set state based on the previous state.</p>
<pre><code class="jsx">const App = () =&gt; &#123;
  const [num, setNum] = useState(0); // same API as useState

  const handleClick = () =&gt; &#123;
    setNum(prevState =&gt; prevState + 1);
  &#125;;
  return &lt;button onClick=&#123;handleClick&#125;&gt;Increment&lt;/button&gt;;
&#125;
</code></pre>
<h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><p>This is a use case that I encountered during development and I think this would be a perfect example to learn and demonstrate the concept of <code>useEffect</code> and <code>useState</code> hooks in React.js. When functional component started to take over class-based component, I firstly use the <code>useEffect</code> hook the way that I use <code>componentDidMount()</code>, <code>componentDidUpdate()</code> and <code>componentDidUnmount()</code> function. After a while, I started to learn that they may share most of the use cases, but the conception is different and <code>useEffect</code> hooks tends to be a much cleaner way to implement and manage a single logic at one place instead of having to use multiple lifecycle functions to trigger&#x2F;subscribe&#x2F;unsubscribe side effects.</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p>React docs: <a class="link"   target="_blank" rel="noopener" href="https://reactjs.org/docs/hooks-effect.html" >https://reactjs.org/docs/hooks-effect.html<i class="fas fa-external-link-alt"></i></a></p>

        </div>

        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/Hooks/">#Hooks</a>&nbsp;
                    </li>
                
                    <li class="tag-item">
                        <a href="/tags/React/">#React</a>&nbsp;
                    </li>
                
                    <li class="tag-item">
                        <a href="/tags/Web/">#Web</a>&nbsp;
                    </li>
                
            </ul>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2022/05/03/Draw-a-triangle-caret-with-pure-css/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Draw a triangle caret with pure CSS</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
            </div>
        
        
            <div class="comment-container">
                <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments">&nbsp;Comments</i>
    </div>
    

        
    
</div>

            </div>
        
        <!-- Config for comment using utterance -->
        
            <script src="https://utteranc.es/client.js"
                    repo="playitsafe/my-blog-comments"
                    issue-term="pathname"
                    theme="github-light"
                    crossorigin="anonymous"
                    async>
            </script>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>
              -
            
            2024&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">Aaron Zhang</a>
        </div>
        
            <script async  src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        Totalview&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        
        
        <!-- Highlight.js -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/highlight.min.js" integrity="sha512-BNc7saQYlxCL10lykUYhFBcnzdKMnjx5fp5s5wPucDyZ7rKNwCoqJh1GwEAIhuePEK4WM9askJBRsu7ma0Rzvg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/styles/github-dark-dimmed.min.css" integrity="sha512-zcatBMvxa7rT7dDklfjauWsfiSFParF+hRfCdf4Zr40/MmA1gkFcBRbop0zMpvYF3FmznYFgcL8wlcuO/GwHoA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <script>
            hljs.highlightAll();
        </script>

    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fas fa-comment"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Prefix"><span class="nav-text">Prefix</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Requirements-Analysis"><span class="nav-text">Requirements Analysis</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Implementation-in-a-React-component"><span class="nav-text">Implementation in a React component</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Basic-setup"><span class="nav-text">Basic setup:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Add-timer-logic"><span class="nav-text">Add timer logic</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#useEffect-dependency-list"><span class="nav-text">useEffect() dependency list</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Inside-of-the-timer-logic"><span class="nav-text">Inside of the timer logic</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Review"><span class="nav-text">Review</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Summary"><span class="nav-text">Summary</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#References"><span class="nav-text">References</span></a></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>



    
<script src="/js/local-search.js"></script>




    
<script src="/js/code-copy.js"></script>




    
<script src="/js/lazyload.js"></script>



<div class="post-scripts">
    
        
<script src="/js/left-side-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>



</body>
</html>
